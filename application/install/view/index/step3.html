{include file="public/header" /}
<style type="text/css">
    .layui-table td, .layui-table th {
        text-align: left;
    }

    .layui-table tbody tr.no {
        background-color: #f00;
        color: #fff;
    }
</style>
<div class="install-box">
    <fieldset class="layui-elem-field layui-field-title">
        <legend>数据库配置</legend>
    </fieldset>
    <form class="layui-form layui-form-pane" action="?step=4" method="post">
        <div class="layui-form-item">
            <label class="layui-form-label">服务器地址</label>
            <div class="layui-input-inline w200">
                <input type="text" class="layui-input" name="hostname" value="127.0.0.1">
            </div>
            <div class="layui-form-mid layui-word-aux">数据库服务器地址，一般为127.0.0.1</div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">数据库端口</label>
            <div class="layui-input-inline w200">
                <input type="text" class="layui-input" name="hostport" value="3306">
            </div>
            <div class="layui-form-mid layui-word-aux">系统数据库端口，一般为3306</div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">数据库名称</label>
            <div class="layui-input-inline w200">
                <input type="text" class="layui-input" name="database">
            </div>
            <div class="layui-form-mid layui-word-aux">系统数据库名,必须包含字母</div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">数据库账号</label>
            <div class="layui-input-inline w200">
                <input type="text" class="layui-input" name="username">
            </div>
            <div class="layui-form-mid layui-word-aux">连接数据库的用户名</div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">数据库密码</label>
            <div class="layui-input-inline w200">
                <input type="password" class="layui-input" name="password">
            </div>
            <div class="layui-form-mid layui-word-aux">连接数据库的密码</div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">数据库前缀</label>
            <div class="layui-input-inline w200">
                <input type="text" class="layui-input" name="prefix" value="xwx">
            </div>
            <div class="layui-form-mid layui-word-aux">建议使用默认</div>
        </div>

        <div class="layui-form-item">
            <button type="submit" class="layui-btn fl" style="margin-left:120px;" lay-submit="" lay-filter="formTest">
                测试数据连接
            </button>
            <div class="layui-form-mid layui-word-aux">请先点击 【测试数据连接】 再安装</div>
        </div>
    </form>
    <form class="layui-form layui-form-pane" action="?step=5" method="post">
        <fieldset class="layui-elem-field layui-field-title">
            <legend>管理账号设置</legend>
        </fieldset>
        <div class="layui-form-item">
            <label class="layui-form-label">管理员账号</label>
            <div class="layui-input-inline w200">
                <input type="text" class="layui-input" name="username">
            </div>
            <div class="layui-form-mid layui-word-aux">管理员账号最少4位，最大20位</div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">管理员密码</label>
            <div class="layui-input-inline w200">
                <input type="text" class="layui-input" name="password">
            </div>
            <div class="layui-form-mid layui-word-aux">保证密码最少6位</div>
        </div>
        <!--        <div class="layui-form-item">-->
        <!--            <label class="layui-form-label">密码盐</label>-->
        <!--            <div class="layui-input-inline w200">-->
        <!--                <input type="text" class="layui-input" name="salt">-->
        <!--            </div>-->
        <!--            <div class="layui-form-mid layui-word-aux">随便输入几个字符</div>-->
        <!--        </div>-->

        <fieldset class="layui-elem-field layui-field-title">
            <legend>缓存设置</legend>
        </fieldset>
        <div class="layui-form-item">
            <label class="layui-form-label">缓存类型</label>
            <div class="layui-input-inline wauto">
                <input type="radio" lay-filter="File" value="File" name="cache_type" title="File" checked>
                <input type="radio" lay-filter="Redis" value="Redis" name="cache_type" title="Redis">
                <input type="radio" lay-filter="Memcached" value="Memcached" name="cache_type" title="Memcached">
            </div>
        </div>
        <div id="cache_ip" class="layui-form-item" style="display: none">
            <label class="layui-form-label">IP地址</label>
            <div class="layui-input-inline w200">
                <input type="text" value="127.0.0.1" class="layui-input" name="cache_ip">
            </div>
            <div class="layui-form-mid layui-word-aux">缓存组件的IP地址</div>
        </div>
        <div id="cache_port" class="layui-form-item" style="display: none">
            <label class="layui-form-label">端口</label>
            <div class="layui-input-inline w200">
                <input type="number" class="layui-input" name="cache_port">
            </div>
            <div class="layui-form-mid layui-word-aux">缓存组件的端口</div>
        </div>
        <div id="cache_pwd" class="layui-form-item" style="display: none">
            <label class="layui-form-label">密码</label>
            <div class="layui-input-inline w200">
                <input type="password" class="layui-input" name="cache_pwd">
            </div>
            <div class="layui-form-mid layui-word-aux">缓存组件的密码</div>
        </div>

        <div id="redis_prefix" class="layui-form-item" style="display: none">
            <label class="layui-form-label">redis前缀</label>
            <div class="layui-input-inline w200">
                <input type="text" class="layui-input" name="redis_prefix">
            </div>
            <div class="layui-form-mid layui-word-aux">区分一台机器上多个网站的缓存</div>
        </div>


        <div class="step-btns">
            <a href="?step=2" class="layui-btn layui-btn-primary layui-btn-big fl">返回上一步</a>
            <button type="submit" class="layui-btn layui-btn-big layui-btn-normal fr" lay-submit=""
                    lay-filter="formSubmit">立即执行安装
            </button>
        </div>
    </form>
</div>

<script>
    var test = 0;
    layui.define(['element', 'form'], function (exports) {
        var $ = layui.jquery, layer = layui.layer, form = layui.form;
        form.on('submit(formTest)', function (data) {
            var _form = '';
            if ($(this).attr('data-form')) {
                _form = $($(this).attr('data-form'));
            } else {
                _form = $(this).parents('form');
            }

            layer.msg('数据提交中...', {time: 500000});
            $.ajax({
                type: "POST",
                url: _form.attr('action'),
                data: _form.serialize(),
                dataType: 'json',
                success: function (res) {
                    if (res.code == 1) {
                        test = 1;
                    }
                    layer.msg(res.msg);
                }
            });
            return false;
        });

        form.on('submit(formSubmit)', function (data) {
            if (test == 0) {
                layer.msg('请先点击并通过测试数据连接！');
                return false;
            }
        });

        form.on('radio(Redis)', function (data) {
            // alert(data.value);
            if (data.value) {
                jQuery('#redis_prefix').css('display', 'block');
                jQuery("#cache_pwd").css('display', 'block');
                jQuery("#cache_ip").css('display', 'block');
                jQuery("#cache_port").css('display', 'block');
                jQuery("input[name=cache_port]").val('6379');
            }
        });
        form.on('radio(File)', function (data) {
            // alert(data.value);
            if (data.value) {
                jQuery('#redis_prefix').css('display', 'none');
                jQuery('#cache_pwd').css('display', 'none');
                jQuery('#cache_ip').css('display', 'none');
                jQuery('#cache_port').css('display', 'none');
            }
        });
        form.on('radio(Memcached)', function (data) {
            // alert(data.value);
            if (data.value) {
                jQuery('#redis_prefix').css('display', 'none');
                jQuery("#cache_ip").css('display', 'block');
                jQuery("#cache_port").css('display', 'block');
                jQuery('#cache_pwd').css('display', 'none');
                jQuery("input[name=cache_port]").val('11211');
            }
        });
    });

    // jQuery(function () {
    //     jQuery('#redis').on('click',function () {
    //         jQuery('#redis_prefix').css('display','block');
    //         console.log('1');
    //
    //     });
    //     let otherCacheType = function ()
    //     {
    //         jQuery('#redis_prefix').css('display','none');
    //     }
    //     jQuery('#file').on('click',otherCacheType);
    //     jQuery('#memcached').on('click',otherCacheType);
    //
    // });
</script>
{include file="public/footer" /}